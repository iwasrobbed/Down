osx_image: xcode11
language: objective-c
before_install:
  - set -o pipefail
  - gem install xcpretty slather -N
  - xcrun simctl boot "iPhone Xs" || echo "(Pre)Launched the simulator."
script:
  - travis_retry xcodebuild -project Down.xcodeproj -scheme "Down" -destination "platform=iOS Simulator,OS=12.2,name=iPhone Xs" -enableCodeCoverage YES ONLY_ACTIVE_ARCH=YES test | xcpretty -c
  - travis_retry xcodebuild -project Down.xcodeproj -scheme "Down" -sdk macosx -destination 'platform=OS X,arch=x86_64' -enableCodeCoverage YES test | xcpretty -c
  - travis_retry xcodebuild -project Down.xcodeproj -scheme "Down" -sdk appletvsimulator -destination 'platform=tvOS Simulator,name=Apple TV' -enableCodeCoverage YES test | xcpretty -c
  - travis_retry xcodebuild -project Down.xcodeproj -scheme "DownSnapshotTests" -destination "platform=iOS Simulator,OS=13.0,,name=iPhone 11" -enableCodeCoverage YES ONLY_ACTIVE_ARCH=YES test | xcpretty -c
after_success:
  - slather coverage --ignore "../**/*/Xcode*" --ignore "Source/cmark/*" --scheme "Down" Down.xcodeproj
  - slather coverage --ignore "../**/*/Xcode*" --ignore "Source/cmark/*" --scheme "DownSnapshotTests" Down.xcodeproj
  - bash <(curl -s https://codecov.io/bash) -f coverage/cobertura.xml -X coveragepy -X gcov -X xcode
